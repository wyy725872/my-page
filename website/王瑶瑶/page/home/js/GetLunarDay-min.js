var LunarDaysOfMonth=new Array(54440,54432,55888,23208,22176,43736,9680,37584,51544,43344,46240,46416,46416,21928,19360,42416,21176,21168,43312,29864,27296,44368,19880,19296,38256,42208,53856,59696,54576,23200,27472,38608,19176,19152,42192,53848,53840,54560,55968,46496,22224,19160,18864,42168,42160,43600,46376,27936,44448,21936);var LunarLeapYear=new Array(64,2,7,0,80,4,9,0,96,4,0,32,96,5,0,48,176,6,0,80,2,7,0,80,3);function GetLeapMonth(iLunarYear){var Leap=LunarLeapYear[iLunarYear-2001>>1];return(iLunarYear-2001&1)==0?Leap>>4:Leap&15}function LunarMonthDays(iLunarYear,iLunarMonth){var High;var Low;var Bit;High=0;Low=29;Bit=16-iLunarMonth;if(iLunarMonth>GetLeapMonth(iLunarYear)&&GetLeapMonth(iLunarYear)>0)Bit--;if((LunarDaysOfMonth[iLunarYear-2001]&1<<Bit)>0)Low++;if(iLunarMonth==GetLeapMonth(iLunarYear)){High=(LunarDaysOfMonth[iLunarYear-2001]&1<<Bit-1)>0?30:29}return Low+(High<<16)}function LunarYearDays(iLunarYear){var Days;var tmp;Days=0;for(var i=1;i<=12;i++){tmp=LunarMonthDays(iLunarYear,i);Days=Days+(tmp>>16&65535);Days=Days+(tmp&65535)}return Days}function FormatLunarYear(iLunarYear){var szText1=new String("甲乙丙丁戊己庚辛壬癸");var szText2=new String("子丑寅卯辰巳午未申酉戌亥");var strYear;strYear=szText1.substr((iLunarYear-4)%10,1);strYear=strYear+szText2.substr((iLunarYear-4)%12,1);return strYear+"年"}function FormatLunarMonth(iLunarMonth){var szText=new String("正二三四五六七八九十");var strMonth;if(iLunarMonth<=10){strMonth=szText.substr(iLunarMonth-1,1)}else if(iLunarMonth==11)strMonth="十一";else strMonth="十二";return strMonth+"月"}function FormatLunarDay(iLunarDay){var szText1=new String("初十廿三");var szText2=new String("一二三四五六七八九十");var strDay;if(iLunarDay!=20&&iLunarDay!=30){strDay=szText1.substr((iLunarDay-1)/10,1)+szText2.substr((iLunarDay-1)%10,1)}else if(iLunarDay!=20){strDay=szText1.substr(iLunarDay/10,1)+"十"}else{strDay="二十"}return strDay}function GetLunarDateString(SolarDate){var tmp;var iLunarYear;var iLunarMonth;var iLunarDay;var Leap=false;var MinMilli=1e3*60;var HrMilli=MinMilli*60;var DyMilli=HrMilli*24;var iSpanDays=Math.round(SolarDate.getTime()/DyMilli)-11323;if(iSpanDays<23){iYear=2e3;iLunarMonth=12;iLunarDay=iSpanDays+7}else{iSpanDays=iSpanDays-23;iLunarYear=2001;iLunarMonth=1;iLunarDay=1;tmp=LunarYearDays(iLunarYear);while(iSpanDays>=tmp){iSpanDays-=tmp;iLunarYear++;tmp=LunarYearDays(iLunarYear)}tmp=LunarMonthDays(iLunarYear,iLunarMonth)&65535;while(iSpanDays>=tmp){iSpanDays-=tmp;if(iLunarMonth==GetLeapMonth(iLunarYear)){tmp=LunarMonthDays(iLunarYear,iLunarMonth)>>16;if(iSpanDays<tmp){Leap=tmp>0?true:false;break}iSpanDays=iSpanDays-tmp}iLunarMonth++;tmp=LunarMonthDays(iLunarYear,iLunarMonth)&65535}iLunarDay+=iSpanDays}return FormatLunarDay(iLunarDay)}